# DragBlock

**DragBlock** ‚Äî —ç—Ç–æ –∑–∞—â–∏—Ç–Ω–∞—è DLL-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è Windows, –±–ª–æ–∫–∏—Ä—É—é—â–∞—è –ø–µ—Ä–µ–Ω–æ—Å –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –º–µ–∂–¥—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏ —á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω–∏–∑–º `DoDragDrop`. –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º–∞—Ö –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —É—Ç–µ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö (DLP).

## üõ° –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É –∏–ª–∏ –∏–Ω—ä–µ–∫—Ü–∏–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å—ã, DragBlock:

- –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–∑–æ–≤ `DoDragDrop` –∏–∑ `ole32.dll`
- –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –ø–µ—Ä–µ–Ω–æ—Å–∏–º—ã–π –æ–±—ä–µ–∫—Ç —Ç–µ–∫—Å—Ç (–≤ —Ñ–æ—Ä–º–∞—Ç–∞—Ö `CF_TEXT` –∏–ª–∏ `CF_UNICODETEXT`)
- –æ—Ç–º–µ–Ω—è–µ—Ç –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç
- –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –∂—É—Ä–Ω–∞–ª Windows

## ‚öôÔ∏è –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- üìã –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `Event Log` (–∂—É—Ä–Ω–∞–ª Windows)
- üîç –û—Ç–ª–∞–¥–æ—á–Ω—ã–π —Ä–µ–∂–∏–º —Å –∏–∑–º–µ—Ä–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π
- ‚ö†Ô∏è –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ —Ö—É–∫–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º –∂—É—Ä–Ω–∞–ª–µ

## üîß –°–±–æ—Ä–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Visual Studio 2022 —Å —Ä–∞–±–æ—á–µ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π **Desktop development with C++**
- [MinHook](https://github.com/TsudaKageyu/minhook) ‚Äî –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å/—Å–∫–∞—á–∞—Ç—å –∏ —Å–æ–±—Ä–∞—Ç—å `.lib` –¥–ª—è x64/x86

### –®–∞–≥–∏

1. –°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π MinHook –∏ —Å–æ–±–µ—Ä–∏—Ç–µ `libMinHook.x64.lib` –∏ `libMinHook.x86.lib` –∏–∑ `build/VC17`.
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏—Ö –≤ –ø–∞–ø–∫—É `external\minhook\lib`.
3. –î–æ–±–∞–≤—å—Ç–µ –≤ —Å–≤–æ–π—Å—Ç–≤–∞ –ø—Ä–æ–µ–∫—Ç–∞:
   - `Additional Include Directories` ‚Üí `external\minhook\include`
   - `Additional Library Directories` ‚Üí `external\minhook\lib`
4. –î–ª—è **x64** —Å–±–æ—Ä–∫–∏:
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `Target Name` ‚Üí `DragBlock.64`
5. –î–ª—è **x86** (Win32) —Å–±–æ—Ä–∫–∏:
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `Target Name` ‚Üí `DragBlock.32`

## ü™µ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ñ—É—Ä–Ω–∞–ª –∑–∞–ø–∏—Å–µ–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤:

```
–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚Üí –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–±—ã—Ç–∏–π
‚Üí –ñ—É—Ä–Ω–∞–ª—ã Windows ‚Üí –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí –ò—Å—Ç–æ—á–Ω–∏–∫: DragBlock
```

### –†–µ–∂–∏–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

- **–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º** (`LOG_ENABLED = true`) ‚Äî —Å—Ç–∞—Ä—Ç, –æ—Å—Ç–∞–Ω–æ–≤–∫–∞, –æ—à–∏–±–∫–∏
- **–û—Ç–ª–∞–¥–æ—á–Ω—ã–π —Ä–µ–∂–∏–º** (`DEBUG_MODE = true`) ‚Äî –≤—Ö–æ–¥ –≤ —Ñ—É–Ω–∫—Ü–∏–∏, –≤—Ä–µ–º—è –∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

> ‚ö†Ô∏è –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Å–æ–±—ã—Ç–∏–π DLL –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω–∞ —Å –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

## üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: `AppInit_DLLs` (–¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π –∏–Ω—ä–µ–∫—Ü–∏–∏)

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ DLL –ø–æ–¥–ø–∏—Å–∞–Ω–∞ (–∏–ª–∏ –æ—Ç–∫–ª—é—á–µ–Ω–æ `RequireSignedAppInit_DLLs`)
2. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–ø–∏—Å—å:

```reg
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows]
"LoadAppInit_DLLs"=dword:00000001
"AppInit_DLLs"="C:\\Path\\To\\DragBlock.64.dll"
"RequireSignedAppInit_DLLs"=dword:00000000
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò–Ω—ä–µ–∫—Ü–∏—è –≤—Ä—É—á–Ω—É—é

- –ß–µ—Ä–µ–∑ `SetWindowsHookEx`, `CreateRemoteThread`, –∏–ª–∏ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `DLL Injector`)

## üì¶ –°–±–æ—Ä–∫–∞ –≤ –¥–≤—É—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞—Ö

| –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ | –ò–º—è DLL             | –ü—É—Ç—å             |
|-----------|---------------------|------------------|
| x64       | `DragBlock.64.dll` | `x64\Release\` |
| x86       | `DragBlock.32.dll` | `Release\`      |

## üõë –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ (–µ—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `DoDragDrop`)
- –ò–Ω—ä–µ–∫—Ü–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å—ã —Å –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—Å–∫–∞ —Å —Ç–µ–º–∏ –∂–µ –ø—Ä–∞–≤–∞–º–∏
- `AppInit_DLLs` —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å GUI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏, –∑–∞–≥—Ä—É–∂–∞—é—â–∏–º–∏ `user32.dll`

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è MinHook ‚Äî –æ–Ω —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π BSD-2-Clause)

## üß† –ê–≤—Ç–æ—Ä—ã –∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ

–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –∏–∑—É—á–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Windows Drag & Drop (OLE), MinHook, –∏ –ø—Ä–∞–∫—Ç–∏–∫ –∑–∞—â–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —É—Ä–æ–≤–Ω–µ API.
